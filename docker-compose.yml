services:
  api:
    build: .
    network_mode: host
    environment:
      - OLLAMA_BASE_URL=http://127.0.0.1:11434
      - OLLAMA_MODEL=phi4
      - DB_PATH=/data/wellspring.db
      - LOG_LEVEL=INFO
      - OPENCTI_URL=https://opencti.dig-sec.com
      - OPENCTI_TOKEN=671267dd-c6b2-404d-9f9d-f569131feed1
      - WATCHED_FOLDERS=/data/documents
    volumes:
      - /mnt/nvme0n1p1/wellspring:/data
      - /mnt/storage2:/data/documents:ro

  worker:
    build: .
    command: ["python", "-m", "wellspring.worker.main"]
    environment:
      - OLLAMA_BASE_URL=http://host.docker.internal:11434
      - OLLAMA_MODEL=phi4
      - DB_PATH=/data/wellspring.db
      - LOG_LEVEL=INFO
    volumes:
      - /mnt/nvme0n1p1/wellspring:/data
    extra_hosts:
      - "host.docker.internal:host-gateway"
